<pre id="display" style="line-height: 75%"></pre>
<canvas id="canvas" style="border: 1px solid black;" width="800" height="800"></canvas>
<script id="in" type="text/input">../.. => .../#.#/...
#./.. => ..#/..#/#..
##/.. => .../#../..#
.#/#. => #../.../...
##/#. => #.#/.#./#..
##/## => ..#/#.#/..#
.../.../... => .#../#..#/#.../.#..
#../.../... => ..##/..##/.#.#/....
.#./.../... => ..##/..##/.###/##..
##./.../... => ..../.##./#.##/..#.
#.#/.../... => ####/#.##/#.##/#.#.
###/.../... => #..#/..#./..../##.#
.#./#../... => ..#./.#../...#/#.##
##./#../... => ..../#.##/#..#/.#..
..#/#../... => ##.#/####/###./###.
#.#/#../... => ..../#.##/.###/#.#.
.##/#../... => ..#./##.#/####/..##
###/#../... => ..#./.##./...#/..#.
.../.#./... => .###/#.../.#../####
#../.#./... => ###./.#.#/#.##/##.#
.#./.#./... => ..##/..#./###./..#.
##./.#./... => #..#/..#./###./...#
#.#/.#./... => #.../##.#/#.##/#..#
###/.#./... => ...#/#..#/####/##.#
.#./##./... => #.##/#.##/..../#.#.
##./##./... => ..##/###./..#./####
..#/##./... => ..../##../##.#/.##.
#.#/##./... => ##../####/####/.#.#
.##/##./... => ..../##.#/.###/##..
###/##./... => .#../#.#./.#../..##
.../#.#/... => ####/#.#./..##/#..#
#../#.#/... => .#../.#../#..#/....
.#./#.#/... => ..##/.##./####/#.#.
##./#.#/... => ..#./###./.#../....
#.#/#.#/... => ..#./..#./...#/#...
###/#.#/... => ###./.#../##../####
.../###/... => #.##/####/####/..##
#../###/... => .#.#/...#/###./...#
.#./###/... => ..../.#.#/.#../....
##./###/... => ...#/.###/..../.##.
#.#/###/... => ..##/###./.#../#..#
###/###/... => .###/..#./..#./.###
..#/.../#.. => .##./###./####/#.#.
#.#/.../#.. => ####/#.../#.../..##
.##/.../#.. => ###./#..#/..#./.#..
###/.../#.. => .###/.##./#.#./.###
.##/#../#.. => ##.#/...#/.#.#/...#
###/#../#.. => #.##/..#./..../#..#
..#/.#./#.. => #..#/##.#/.##./####
#.#/.#./#.. => ###./..##/#..#/#..#
.##/.#./#.. => .#../..../...#/...#
###/.#./#.. => .#../##../.###/..#.
.##/##./#.. => ##../..##/##../##.#
###/##./#.. => #.##/#..#/.###/####
#../..#/#.. => ##.#/####/#.../..##
.#./..#/#.. => #..#/..../..../###.
##./..#/#.. => #..#/##.#/##.#/#.#.
#.#/..#/#.. => .###/##.#/####/#...
.##/..#/#.. => ####/.##./...#/#..#
###/..#/#.. => .#.#/####/##.#/...#
#../#.#/#.. => ..##/.##./..##/##..
.#./#.#/#.. => #.../##../..##/..#.
##./#.#/#.. => ...#/##.#/#..#/.#..
..#/#.#/#.. => #.#./##../#.##/###.
#.#/#.#/#.. => ##../##.#/#.#./....
.##/#.#/#.. => ####/...#/####/.#..
###/#.#/#.. => ..../.#../.#../....
#../.##/#.. => .#.#/..#./#..#/.###
.#./.##/#.. => #.../.#.#/.###/.##.
##./.##/#.. => #.#./#.#./.#../###.
#.#/.##/#.. => ####/##../.##./####
.##/.##/#.. => #.../#.#./#.##/###.
###/.##/#.. => ####/####/..../####
#../###/#.. => ####/.##./...#/##.#
.#./###/#.. => .#../#.##/#..#/..##
##./###/#.. => #.#./..##/#.../..##
..#/###/#.. => #.##/.###/#.#./###.
#.#/###/#.. => #.##/#.##/..../#..#
.##/###/#.. => .##./#.#./..##/####
###/###/#.. => .##./#..#/#.../###.
.#./#.#/.#. => #.#./#..#/#..#/##.#
##./#.#/.#. => ...#/#.#./##.#/###.
#.#/#.#/.#. => ##.#/..##/##.#/#.##
###/#.#/.#. => .#.#/..#./##../.##.
.#./###/.#. => #..#/..#./..##/#...
##./###/.#. => ####/.#.#/####/..#.
#.#/###/.#. => #.#./..##/##../#..#
###/###/.#. => ...#/..../..../#.#.
#.#/..#/##. => ..#./.##./###./.#.#
###/..#/##. => #.../###./...#/####
.##/#.#/##. => ..../..../.###/##..
###/#.#/##. => ##../..../#.#./.##.
#.#/.##/##. => .#.#/##../..##/#.#.
###/.##/##. => ###./####/...#/.#..
.##/###/##. => ..##/#.../..##/.#.#
###/###/##. => ..##/...#/.###/.#..
#.#/.../#.# => ..##/#.../##.#/....
###/.../#.# => #.##/#..#/..../##..
###/#../#.# => #.../..../##.#/..#.
#.#/.#./#.# => ###./..##/.#../.##.
###/.#./#.# => ..../#..#/.###/#..#
###/##./#.# => .#.#/###./##.#/.###
#.#/#.#/#.# => ..../..../.##./#..#
###/#.#/#.# => .###/.#.#/...#/.###
#.#/###/#.# => .#.#/##../.#../.#..
###/###/#.# => .#.#/.##./#.##/....
###/#.#/### => ..#./..#./..#./..##
###/###/### => ##.#/..##/.#.#/....</script>
<script>
    let c = document.getElementById("canvas");
    let ctx = c.getContext("2d");
    let input = document.getElementById("in").innerHTML;
    
    let counter = 0;
    input = input.split("\n");
    input = input.map(a => a.split(" => "));
    
    let image = [".#./..#/###"];
    //let image = [".../.../..."];
    
    function enhance(block){
        let index = -1;
        for(let j=0; j<input.length; j++){
            for(let k=0; k<4;k++){
                for(let l=0; l<4;l++){
                    if(flip(rotate(input[j][0], k), l) == block)index = j;
                }
            }
        }
        if(index == -1)return block;
        else{
            //console.log(index);
            block = input[index][1];
            return block;
        }
    }
    
    function devide(block){
        let b = block.split("/").map(a => a.split(""));
        let out = [];
        if(b.length%2 == 0){
            for(let i=0; i<b.length/2; i++){
                for(let j=0; j<b.length/2; j++){
                    let part = [];

                    for(let y=b.length/2*(i); y<b.length/2*(i+1); y++){
                        let row = [];
                        for(let x=b.length/2*(j); x<b.length/2*(j+1); x++){
                            row.push(b[y][x]);
                        }
                        part.push(row);
                    }

                    let partText = part.map(a => a.join("")).join("/")
                    out.push(partText);
                }
            }
        }
        else{
            out.push(block);
        }
        return out;
    }
    
    function rotate(block, rotations){
        let b = block.split("/").map(a => a.split(""));
        let out = block;
        for(let r=0; r<rotations; r++){
            //naploni prezen array
            let rb = [];
            for(let y=0; y<b.length; y++){
                let line = [];
                for(let x=0; x<b[y].length; x++){
                    line.push(0);
                }
                rb.push(line);
            }

            let n = rb.length;

            for (let i = 0; i < n; ++i) {
                for (let j = 0; j < n; ++j) {
                    rb[i][j] = b[n - j - 1][i];
                }
            }
            
            out = rb.map(a => a.join("")).join("/");
            b = out.split("/").map(a => a.split(""));
        }
        return out;
    }
    
    function flip(block, flips){
        let b = block.split("/").map(a => a.split(""));
        let rb = [];
        for(let y=0; y<b.length; y++){
            let line = [];
            for(let x=0; x<b[y].length; x++){
                line.push(b[y][x]);
            }
            rb.push(line);
        }
        let n = rb.length;
        if(flips == 1){
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    rb[i][j] = b[i][n-1-j];
                }
            }
        }
        if(flips == 2){
            for (let i = 0; i < n; ++i) {
                for (let j = 0; j < n; ++j) {
                    rb[i][j] = b[n-1-i][j];
                }
            }
        }
        if(flips == 3){
            for (let i = 0; i < n; ++i) {
                for (let j = 0; j < n; ++j) {
                    rb[i][j] = b[n-1-i][n-1-j];
                }
            }
        }
        out = rb.map(a => a.join("")).join("/");
        return out;
    }
    
    function displayText(block){
        let html = "";

        for(let x=0; x<block.length; x++){
            if(block[x] == "/")html+="\n";
            else html += block[x];
        }
        html += "\n";
        document.getElementById("display").innerHTML += "<hr>"+html;
    }
    
    function display(block, xOff, yOff){
        let b = block.split("/").map(a => a.split(""));
        for(let y=0; y<b.length; y++){
            for(let x=0; x<b[y].length; x++){
                if(b[y][x] == "#"){
                    ctx.fillStyle = "#2281bc";
                    counter++;
                }
                else ctx.fillStyle = "#cbcbcb";
                
                ctx.fillRect((xOff+x)*50, (yOff+y)*50, 50, 50)
            }
        }
    }
    
    function main(block, iteration, iterations, xOff, yOff){
        console.log(iteration, ":", block, "xy:", xOff, yOff)
        let b = block.split("/").map(a => a.split("")); //.length = velikost trenutnega blocka
        if(iteration == iterations)display(block, xOff*b.length, yOff*b.length);
        block = devide(block);
        for(let i=0; i<block.length; i++){
            let partBlock = enhance(block[i]);
            let b = block[i].split("/").map(a => a.split("")); //.length = velikost novega dela blocka ppo delitvi
            let n = b.length;
            let x = i%n;
            let y = Math.floor(i/n);
            if(iteration < iterations)main(partBlock, iteration+1, iterations, xOff+x, yOff+y);
        }
    }
</script>